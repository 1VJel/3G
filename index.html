<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dom치c칤 칔koly a Testy</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
    body {
        margin: 0;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #121212;
        color: #e0e0e0;
        display: flex;
        gap: 20px;
        padding: 20px;
        flex-wrap: wrap;
    }
    .column {
        flex: 1;
        min-width: 300px;
        display: flex;
        flex-direction: column;
        gap: 15px;
    }
    h2, h3 {
        text-align: center;
    }
    ul {
        list-style: none;
        padding: 0;
        max-height: 400px;
        overflow-y: auto;
    }
    li {
        background-color: #1e1e1e;
        padding: 10px;
        border-radius: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 5px;
    }
    input[type="text"], input[type="date"] {
        border-radius: 10px;
        padding: 5px;
        border: none;
        flex: 1;
    }
    .flex-row {
        display: flex;
        gap: 5px;
        margin-bottom: 5px;
    }
    button.submit-btn {
        border-radius: 50px;
        padding: 8px 20px;
        border: none;
        background-color: #6200ea;
        color: white;
        cursor: pointer;
        transition: 0.2s;
        align-self: flex-start;
    }
    button.submit-btn:hover {
        background-color: #7e3ff2;
    }
    .vote-btn {
        border-radius: 50%;
        width: 30px;
        height: 30px;
        border: none;
        margin-left: 5px;
        cursor: pointer;
        opacity: 0.7;
        transition: 0.2s;
    }
    .vote-btn:hover {
        opacity: 1;
    }
    .like { background-color: green; color: white; }
    .dislike { background-color: red; color: white; }
    .pending-container {
        margin-top: 10px;
    }
</style>
</head>
<body>

<div class="column" id="tasks-column">
    <h2>Dom치c칤 칔koly</h2>
    <ul id="tasks-list"></ul>

    <div class="flex-row">
        <input type="text" id="task-subject" placeholder="P콏edm캩t (nap콏. M)" maxlength="2">
        <input type="text" id="task-desc" placeholder="Popis 칰kolu">
        <input type="date" id="task-date">
    </div>
    <button id="task-submit" class="submit-btn">Odeslat</button>

    <div class="pending-container">
        <h3>N치vrhy 칰kol콢</h3>
        <ul id="tasks-pending-list"></ul>
    </div>
</div>

<div class="column" id="tests-column">
    <h2>Testy</h2>
    <ul id="tests-list"></ul>

    <div class="flex-row">
        <input type="text" id="test-subject" placeholder="P콏edm캩t (nap콏. M)" maxlength="2">
        <input type="text" id="test-desc" placeholder="Popis testu">
        <input type="date" id="test-date">
    </div>
    <button id="test-submit" class="submit-btn">Odeslat</button>

    <div class="pending-container">
        <h3>N치vrhy test콢</h3>
        <ul id="tests-pending-list"></ul>
    </div>
</div>

<script>
    // --- Inicializace Supabase ---
    const supabaseUrl = 'https://YOUR_SUPABASE_URL.supabase.co';
    const supabaseKey = 'YOUR_SUPABASE_ANON_KEY';
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    // Jednoduch칠 demo "IP" pro omezen칤 hlasov치n칤
    const ip = "user-" + Math.floor(Math.random() * 1000000);

    // --- Na캜칤t치n칤 hlavn칤ch seznam콢 ---
    async function loadTasks() {
        const { data } = await supabase.from('task').select('*').order('date', { ascending: true });
        const list = document.getElementById('tasks-list');
        list.innerHTML = '';
        data.forEach(task => {
            const li = document.createElement('li');
            li.textContent = `[${task.subject}] ${task.desc} (${task.date})`;
            list.appendChild(li);
        });
    }

    async function loadTests() {
        const { data } = await supabase.from('tests').select('*').order('date', { ascending: true });
        const list = document.getElementById('tests-list');
        list.innerHTML = '';
        data.forEach(test => {
            const li = document.createElement('li');
            li.textContent = `[${test.subject}] ${test.desc} (${test.date})`;
            list.appendChild(li);
        });
    }

    // --- Na캜칤t치n칤 pending ---
    async function loadTasksPending() {
        const { data } = await supabase.from('tasks_pending').select('*');
        const list = document.getElementById('tasks-pending-list');
        list.innerHTML = '';
        data.forEach(task => {
            const li = document.createElement('li');
            const content = document.createElement('span');
            content.textContent = `[${task.subject}] ${task.desc} (${task.date})`;

            const like = document.createElement('button');
            like.className = 'vote-btn like';
            like.textContent = '游녨';
            like.addEventListener('click', () => votePending('tasks_pending', task.id, 'up'));

            const dislike = document.createElement('button');
            dislike.className = 'vote-btn dislike';
            dislike.textContent = '游녩';
            dislike.addEventListener('click', () => votePending('tasks_pending', task.id, 'down'));

            li.appendChild(content);
            li.appendChild(like);
            li.appendChild(dislike);
            list.appendChild(li);
        });
    }

    async function loadTestsPending() {
        const { data } = await supabase.from('tests_pending').select('*');
        const list = document.getElementById('tests-pending-list');
        list.innerHTML = '';
        data.forEach(test => {
            const li = document.createElement('li');
            const content = document.createElement('span');
            content.textContent = `[${test.subject}] ${test.desc} (${test.date})`;

            const like = document.createElement('button');
            like.className = 'vote-btn like';
            like.textContent = '游녨';
            like.addEventListener('click', () => votePending('tests_pending', test.id, 'up'));

            const dislike = document.createElement('button');
            dislike.className = 'vote-btn dislike';
            dislike.textContent = '游녩';
            dislike.addEventListener('click', () => votePending('tests_pending', test.id, 'down'));

            li.appendChild(content);
            li.appendChild(like);
            li.appendChild(dislike);
            list.appendChild(li);
        });
    }

    // --- P콏id치n칤 do pending ---
    async function addTaskPending() {
        const subject = document.getElementById('task-subject').value;
        const desc = document.getElementById('task-desc').value;
        const date = document.getElementById('task-date').value;
        if (!subject || !desc || !date) return;
        await supabase.from('tasks_pending').insert([{ subject, desc, date, up:0, down:0 }]);
        document.getElementById('task-subject').value = '';
        document.getElementById('task-desc').value = '';
        document.getElementById('task-date').value = '';
        loadTasksPending();
    }

    async function addTestPending() {
        const subject = document.getElementById('test-subject').value;
        const desc = document.getElementById('test-desc').value;
        const date = document.getElementById('test-date').value;
        if (!subject || !desc || !date) return;
        await supabase.from('tests_pending').insert([{ subject, desc, date, up:0, down:0 }]);
        document.getElementById('test-subject').value = '';
        document.getElementById('test-desc').value = '';
        document.getElementById('test-date').value = '';
        loadTestsPending();
    }

    // --- Hlasov치n칤 ---
    async function votePending(table, id, type) {
        const voteKey = `${table}-${id}-${ip}`;
        if (localStorage.getItem(voteKey)) return alert("Ji jste hlasovali");
        localStorage.setItem(voteKey, '1');

        const { data } = await supabase.from(table).select('*').eq('id', id).single();
        const newUp = type === 'up' ? data.up + 1 : data.up;
        const newDown = type === 'down' ? data.down + 1 : data.down;

        await supabase.from(table).update({ up: newUp, down: newDown }).eq('id', id);

        // p콏esun pokud 2 nebo v칤ce dislik콢
        if (newDown >= 2) {
            if (table === 'tasks_pending') {
                await supabase.from('task').insert([{ subject: data.subject, desc: data.desc, date: data.date }]);
            } else {
                await supabase.from('tests').insert([{ subject: data.subject, desc: data.desc, date: data.date }]);
            }
            await supabase.from(table).delete().eq('id', id);
        }

        loadTasks();
        loadTasksPending();
        loadTests();
        loadTestsPending();
    }

    // --- P콏ipojen칤 tla캜칤tek ---
    document.getElementById('task-submit').addEventListener('click', addTaskPending);
    document.getElementById('test-submit').addEventListener('click', addTestPending);

    // --- Inicializace ---
    loadTasks();
    loadTasksPending();
    loadTests();
    loadTestsPending();
</script>

</body>
</html>
