<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dom치c칤 칔koly a Testy</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
    /* --- Modern칤 tmav칳 styl --- */
    body {
        margin: 0;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #121212;
        color: #e0e0e0;
        display: flex;
        gap: 20px;
        padding: 20px;
    }
    .column {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 15px;
    }
    h2 {
        text-align: center;
    }
    ul {
        list-style: none;
        padding: 0;
    }
    li {
        background-color: #1e1e1e;
        padding: 10px;
        border-radius: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 5px;
    }
    input, select {
        border-radius: 10px;
        padding: 5px;
        border: none;
        margin-right: 5px;
    }
    input[type="text"], input[type="date"] {
        width: calc(100% - 10px);
    }
    button.submit-btn {
        border-radius: 50px;
        padding: 8px 20px;
        border: none;
        background-color: #6200ea;
        color: white;
        cursor: pointer;
        transition: 0.2s;
    }
    button.submit-btn:hover {
        background-color: #7e3ff2;
    }
    .vote-btn {
        border-radius: 50%;
        width: 30px;
        height: 30px;
        border: none;
        margin-left: 5px;
        cursor: pointer;
        opacity: 0.7;
        transition: 0.2s;
    }
    .vote-btn:hover {
        opacity: 1;
    }
    .like { background-color: green; color: white; }
    .dislike { background-color: red; color: white; }
    .pending-container {
        margin-top: 10px;
    }
    .flex-row {
        display: flex;
        gap: 5px;
        align-items: center;
    }
</style>
</head>
<body>

<div class="column" id="tasks-column">
    <h2>Dom치c칤 칔koly</h2>
    <ul id="tasks-list"></ul>

    <div>
        <div class="flex-row">
            <input type="text" id="task-subject" placeholder="P콏edm캩t (nap콏. M)" maxlength="2">
            <input type="text" id="task-desc" placeholder="Popis 칰kolu">
            <input type="date" id="task-date">
        </div>
        <button class="submit-btn" onclick="addTaskPending()">Odeslat</button>
    </div>

    <div class="pending-container">
        <h3>N치vrhy 칰kol콢</h3>
        <ul id="tasks-pending-list"></ul>
    </div>
</div>

<div class="column" id="tests-column">
    <h2>Testy</h2>
    <ul id="tests-list"></ul>

    <div>
        <div class="flex-row">
            <input type="text" id="test-subject" placeholder="P콏edm캩t (nap콏. M)" maxlength="2">
            <input type="text" id="test-desc" placeholder="Popis testu">
            <input type="date" id="test-date">
        </div>
        <button class="submit-btn" onclick="addTestPending()">Odeslat</button>
    </div>

    <div class="pending-container">
        <h3>N치vrhy test콢</h3>
        <ul id="tests-pending-list"></ul>
    </div>
</div>

<script>
    // --- Inicializace Supabase ---
    const supabaseUrl = 'https://ihzhwcuxheclfomcwclr.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imloemh3Y3V4aGVjbGZvbWN3Y2xyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ0NDg0MTQsImV4cCI6MjA4MDAyNDQxNH0.zTTtyAc3-R3um8ytT5RyJh9kOTy_d7hzL93xIxu71KM';
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    const ip = "user-" + Math.floor(Math.random() * 1000000); // jednoduch칠 IP pro demo

    // --- Funkce pro na캜ten칤 b캩쬹칳ch 칰kol콢 ---
    async function loadTasks() {
        const { data } = await supabase.from('task').select('*').order('date', { ascending: true });
        const list = document.getElementById('tasks-list');
        list.innerHTML = '';
        data.forEach(task => {
            const li = document.createElement('li');
            li.textContent = `[${task.subject}] ${task.desc} (${task.date})`;
            list.appendChild(li);
        });
    }

    async function loadTests() {
        const { data } = await supabase.from('tests').select('*').order('date', { ascending: true });
        const list = document.getElementById('tests-list');
        list.innerHTML = '';
        data.forEach(test => {
            const li = document.createElement('li');
            li.textContent = `[${test.subject}] ${test.desc} (${test.date})`;
            list.appendChild(li);
        });
    }

    // --- Funkce pro na캜ten칤 pending ---
    async function loadTasksPending() {
        const { data } = await supabase.from('tasks_pending').select('*');
        const list = document.getElementById('tasks-pending-list');
        list.innerHTML = '';
        data.forEach(task => {
            const li = document.createElement('li');
            const content = document.createElement('span');
            content.textContent = `[${task.subject}] ${task.desc} (${task.date})`;
            const like = document.createElement('button');
            like.className = 'vote-btn like';
            like.textContent = '游녨';
            like.onclick = () => votePending('tasks_pending', task.id, 'up');
            const dislike = document.createElement('button');
            dislike.className = 'vote-btn dislike';
            dislike.textContent = '游녩';
            dislike.onclick = () => votePending('tasks_pending', task.id, 'down');
            li.appendChild(content);
            li.appendChild(like);
            li.appendChild(dislike);
            list.appendChild(li);
        });
    }

    async function loadTestsPending() {
        const { data } = await supabase.from('tests_pending').select('*');
        const list = document.getElementById('tests-pending-list');
        list.innerHTML = '';
        data.forEach(test => {
            const li = document.createElement('li');
            const content = document.createElement('span');
            content.textContent = `[${test.subject}] ${test.desc} (${test.date})`;
            const like = document.createElement('button');
            like.className = 'vote-btn like';
            like.textContent = '游녨';
            like.onclick = () => votePending('tests_pending', test.id, 'up');
            const dislike = document.createElement('button');
            dislike.className = 'vote-btn dislike';
            dislike.textContent = '游녩';
            dislike.onclick = () => votePending('tests_pending', test.id, 'down');
            li.appendChild(content);
            li.appendChild(like);
            li.appendChild(dislike);
            list.appendChild(li);
        });
    }

    // --- Funkce p콏id치n칤 do pending ---
    async function addTaskPending() {
        const subject = document.getElementById('task-subject').value;
        const desc = document.getElementById('task-desc').value;
        const date = document.getElementById('task-date').value;
        if (!subject || !desc || !date) return;
        await supabase.from('tasks_pending').insert([{ subject, desc, date, up:0, down:0 }]);
        document.getElementById('task-subject').value='';
        document.getElementById('task-desc').value='';
        document.getElementById('task-date').value='';
        loadTasksPending();
    }

    async function addTestPending() {
        const subject = document.getElementById('test-subject').value;
        const desc = document.getElementById('test-desc').value;
        const date = document.getElementById('test-date').value;
        if (!subject || !desc || !date) return;
        await supabase.from('tests_pending').insert([{ subject, desc, date, up:0, down:0 }]);
        document.getElementById('test-subject').value='';
        document.getElementById('test-desc').value='';
        document.getElementById('test-date').value='';
        loadTestsPending();
    }

    // --- Funkce hlasov치n칤 ---
    async function votePending(table, id, type) {
        const voteKey = `${table}-${id}-${ip}`;
        if (localStorage.getItem(voteKey)) return alert("Ji jste hlasovali");
        localStorage.setItem(voteKey, '1');

        const { data } = await supabase.from(table).select('*').eq('id', id).single();
        const newUp = type==='up' ? data.up+1 : data.up;
        const newDown = type==='down' ? data.down+1 : data.down;

        await supabase.from(table).update({ up: newUp, down: newDown }).eq('id', id);

        // p콏esun pokud 2 nebo v칤ce proti
        if (newDown >= 2) {
            if (table === 'tasks_pending') {
                await supabase.from('task').insert([{ subject:data.subject, desc:data.desc, date:data.date }]);
            } else {
                await supabase.from('tests').insert([{ subject:data.subject, desc:data.desc, date:data.date }]);
            }
            await supabase.from(table).delete().eq('id', id);
        }

        loadTasks();
        loadTasksPending();
        loadTests();
        loadTestsPending();
    }

    // --- Inicializace ---
    loadTasks();
    loadTasksPending();
    loadTests();
    loadTestsPending();

</script>
</body>
</html>
